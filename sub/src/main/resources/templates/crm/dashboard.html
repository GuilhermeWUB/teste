<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout-crm}">
<head>
    <title>Dashboard - CRM</title>
    <link rel="stylesheet" th:href="@{/css/crm-dashboard.css}">
</head>
<body>
<section layout:fragment="content">
    <div class="crm-dashboard">
        <!-- Header -->
        <div class="dashboard-header">
            <div>
                <h1 class="greeting-title">Olá, <span id="userName">Usuário</span></h1>
                <p class="greeting-subtitle">Acompanhe seu trabalho e novidades do Power CRM.</p>
            </div>
            <div class="header-actions">
                <button class="btn-refresh" onclick="loadDashboardData()">
                    <i class="bi bi-arrow-clockwise"></i> Atualizar
                </button>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="loading-state">
            <div class="spinner"></div>
            <p>Carregando métricas...</p>
        </div>

        <!-- Main Content -->
        <div id="dashboardContent" style="display: none;">
            <!-- Saldo Section -->
            <div class="section-header">
                <h2 class="section-title">Saldo</h2>
            </div>

            <div class="balance-grid">
                <div class="balance-card available">
                    <div class="balance-label">Disponível</div>
                    <div class="balance-value" id="saldoDisponivel">R$ 0,00</div>
                </div>

                <div class="balance-card to-receive">
                    <div class="balance-label">A Receber</div>
                    <div class="balance-value" id="saldoAReceber">R$ 0,00</div>
                </div>
            </div>

            <!-- Atividades Section -->
            <div class="section-header">
                <h2 class="section-title">Atividades</h2>
            </div>

            <div class="activities-grid">
                <div class="activity-card access-deals">
                    <div class="activity-icon">
                        <i class="bi bi-briefcase"></i>
                    </div>
                    <div class="activity-text">
                        <div class="activity-title">Acesse suas</div>
                        <div class="activity-subtitle">negociações</div>
                    </div>
                </div>

                <div class="activity-card overdue">
                    <div class="activity-number" id="atividadesVencidas">0</div>
                    <div class="activity-info">
                        <div class="activity-label">Atividades</div>
                        <div class="activity-label">Vencidas</div>
                    </div>
                </div>

                <div class="activity-card today">
                    <div class="activity-number" id="atividadesParaHoje">0</div>
                    <div class="activity-info">
                        <div class="activity-label">Atividades</div>
                        <div class="activity-label">Para hoje</div>
                    </div>
                </div>
            </div>

            <!-- Central de Ajuda Section -->
            <div class="section-header">
                <h2 class="section-title">Central de ajuda</h2>
            </div>

            <div class="help-grid">
                <div class="help-card">
                    <div class="help-icon">
                        <i class="bi bi-play-circle"></i>
                    </div>
                    <div class="help-text">
                        <div class="help-title">Curso</div>
                        <div class="help-subtitle">Power CRM</div>
                    </div>
                </div>

                <div class="help-card">
                    <div class="help-icon">
                        <i class="bi bi-question-circle"></i>
                    </div>
                    <div class="help-text">
                        <div class="help-title">Central de</div>
                        <div class="help-subtitle">Ajuda</div>
                    </div>
                </div>

                <div class="help-card">
                    <div class="help-icon">
                        <i class="bi bi-chat-square-text"></i>
                    </div>
                    <div class="help-text">
                        <div class="help-title">Envie uma</div>
                        <div class="help-subtitle">solicitação</div>
                    </div>
                </div>
            </div>

            <!-- Vendas Stats (Hidden for now) -->
            <div class="section-header" style="display: none;">
                <h2><i class="bi bi-cart-check"></i> Vendas</h2>
            </div>

            <div class="stats-grid" style="display: none;">
                <div class="stat-card success" style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); border-left: 4px solid #10b981;">
                    <div class="stat-card-icon" style="background: #10b981;">
                        <i class="bi bi-wallet2"></i>
                    </div>
                    <div class="stat-card-body">
                        <div class="stat-label">Meu Saldo</div>
                        <div class="stat-value" id="meuSaldo" style="color: #065f46;">R$ 0,00</div>
                        <div class="stat-subtitle" style="color: #059669; font-size: 0.875rem;">Saldo acumulado de vendas</div>
                    </div>
                </div>

                <div class="stat-card primary">
                    <div class="stat-card-icon">
                        <i class="bi bi-graph-up-arrow"></i>
                    </div>
                    <div class="stat-card-body">
                        <div class="stat-label">Total de Vendas</div>
                        <div class="stat-value" id="totalVendas">0</div>
                        <div class="stat-trend positive" id="vendasTrend"></div>
                    </div>
                </div>

                <div class="stat-card success">
                    <div class="stat-card-icon">
                        <i class="bi bi-check-circle"></i>
                    </div>
                    <div class="stat-card-body">
                        <div class="stat-label">Vendas Concluídas</div>
                        <div class="stat-value" id="vendasConcluidas">0</div>
                        <div class="stat-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressConcluidas"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="stat-card warning">
                    <div class="stat-card-icon">
                        <i class="bi bi-currency-dollar"></i>
                    </div>
                    <div class="stat-card-body">
                        <div class="stat-label">Receita Total</div>
                        <div class="stat-value" id="receitaTotal">R$ 0</div>
                        <div class="stat-subtitle" id="receitaMes">Este mês: R$ 0</div>
                    </div>
                </div>

                <div class="stat-card info">
                    <div class="stat-card-icon">
                        <i class="bi bi-percent"></i>
                    </div>
                    <div class="stat-card-body">
                        <div class="stat-label">Taxa de Conversão</div>
                        <div class="stat-value" id="taxaConversao">0%</div>
                        <div class="conversion-bar">
                            <div class="conversion-fill" id="conversionFill"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Vendas por Status -->
            <div class="section-header">
                <h2><i class="bi bi-funnel"></i> Funil de Vendas</h2>
            </div>

            <div class="funnel-grid" id="funnelGrid">
                <!-- Será preenchido dinamicamente -->
            </div>

            <!-- Atividades Stats -->
            <div class="section-header">
                <h2><i class="bi bi-calendar-check"></i> Atividades</h2>
            </div>

            <div class="stats-grid activities-grid">
                <div class="stat-card purple">
                    <div class="stat-card-icon">
                        <i class="bi bi-list-check"></i>
                    </div>
                    <div class="stat-card-body">
                        <div class="stat-label">Total de Atividades</div>
                        <div class="stat-value" id="totalAtividades">0</div>
                    </div>
                </div>

                <div class="stat-card cyan">
                    <div class="stat-card-icon">
                        <i class="bi bi-clock-history"></i>
                    </div>
                    <div class="stat-card-body">
                        <div class="stat-label">Agendadas</div>
                        <div class="stat-value" id="atividadesAgendadas">0</div>
                    </div>
                </div>

                <div class="stat-card green">
                    <div class="stat-card-icon">
                        <i class="bi bi-check2-circle"></i>
                    </div>
                    <div class="stat-card-body">
                        <div class="stat-label">Concluídas</div>
                        <div class="stat-value" id="atividadesConcluidas">0</div>
                    </div>
                </div>

                <div class="stat-card orange">
                    <div class="stat-card-icon">
                        <i class="bi bi-calendar-day"></i>
                    </div>
                    <div class="stat-card-body">
                        <div class="stat-label">Hoje</div>
                        <div class="stat-value" id="atividadesHoje">0</div>
                    </div>
                </div>
            </div>

            <!-- Atividades por Tipo -->
            <div class="section-header">
                <h2><i class="bi bi-pie-chart"></i> Atividades por Tipo</h2>
            </div>

            <div class="activities-type-grid" id="activitiesTypeGrid">
                <!-- Será preenchido dinamicamente -->
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions-section" style="display: none;">
                <div class="section-header">
                    <h2><i class="bi bi-lightning-charge"></i> Ações Rápidas</h2>
                </div>
                <div class="action-buttons">
                    <a th:href="@{/crm/vendas}" class="action-btn primary">
                        <i class="bi bi-funnel"></i>
                        <span>Ver Funil de Vendas</span>
                    </a>
                    <a th:href="@{/crm/atividades}" class="action-btn secondary">
                        <i class="bi bi-calendar-plus"></i>
                        <span>Ver Atividades</span>
                    </a>
                    <a th:href="@{/crm/vendas}" class="action-btn success">
                        <i class="bi bi-plus-circle"></i>
                        <span>Nova Negociação</span>
                    </a>
                </div>
            </div>

            <!-- Test Withdrawal Button -->
            <div class="test-section">
                <div class="section-header">
                    <h2 class="section-title">Área de Testes</h2>
                </div>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testWithdrawal()">
                        <i class="bi bi-cash-coin"></i>
                        <span>Criar Saque de Teste</span>
                    </button>
                    <button class="test-btn" onclick="testAddBalance()">
                        <i class="bi bi-plus-circle"></i>
                        <span>Adicionar Saldo de Teste</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script th:src="@{/js/crm-dashboard.js}"></script>
</section>
</body>
</html>
