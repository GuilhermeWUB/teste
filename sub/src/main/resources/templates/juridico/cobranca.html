<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout}">
<head>
    <title>SUB - Processos Jurídicos</title>
    <link rel="stylesheet" th:href="@{/css/kanban-board.css}">
</head>
<body>
<section layout:fragment="content">
    <div class="kanban-wrapper">
        <div class="kanban-header">
            <div class="kanban-header-info">
                <h1><i class="bi bi-kanban"></i> Processos Jurídicos</h1>
                <p>Gerencie processos jurídicos e acompanhe o andamento em tempo real.</p>
            </div>
            <div class="kanban-controls">
                <div class="kanban-controls-left">
                    <div class="kanban-search">
                        <i class="bi bi-search"></i>
                        <input type="text" id="kanban-search" placeholder="Buscar por autor, réu ou número do processo..." autocomplete="off"/>
                    </div>
                </div>
                <div class="kanban-actions">
                    <button class="btn-novo-evento" type="button" onclick="window.processosBoard?.openCreateModal?.()">
                        <i class="bi bi-plus-circle"></i> Novo Processo
                    </button>
                </div>
            </div>
        </div>

        <div class="kanban-alerts">
            <div th:if="${success}" class="kanban-alert success" role="alert">
                <i class="bi bi-check-circle-fill"></i>
                <span th:text="${success}"></span>
                <button type="button" class="kanban-alert-close" onclick="this.parentElement.remove()">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            <div th:if="${error}" class="kanban-alert danger" role="alert">
                <i class="bi bi-exclamation-triangle-fill"></i>
                <span th:text="${error}"></span>
                <button type="button" class="kanban-alert-close" onclick="this.parentElement.remove()">
                    <i class="bi bi-x"></i>
                </button>
            </div>
        </div>

        <div class="kanban-groups">
            <div class="kanban-section" data-group="RASTREADOR">
                <div class="kanban-section-header">
                    <div class="kanban-section-info">
                        <h2 class="kanban-section-title">
                            <i class="bi bi-geo-alt"></i>
                            Rastreador
                        </h2>
                        <p class="kanban-section-subtitle">Fluxo de negociações relacionadas ao rastreador.</p>
                    </div>
                    <span class="kanban-section-count" data-group-count="RASTREADOR">0</span>
                </div>
                <div class="kanban-board" data-group="RASTREADOR">
                    <div class="kanban-column" data-status="RASTREADOR_EM_ABERTO">
                        <div class="column-header">
                            <div class="column-title">
                                <h3>Em Aberto</h3>
                                <span class="column-count">0</span>
                            </div>
                            <button class="column-add-btn" type="button" onclick="window.processosBoard?.openCreateModal?.('RASTREADOR')">
                                <i class="bi bi-plus"></i> Nova
                            </button>
                        </div>
                        <div class="tasks-container"></div>
                    </div>

                    <div class="kanban-column" data-status="RASTREADOR_EM_CONTATO">
                        <div class="column-header">
                            <div class="column-title">
                                <h3>Em Contato</h3>
                                <span class="column-count">0</span>
                            </div>
                            <button class="column-add-btn" type="button" onclick="window.processosBoard?.openCreateModal?.('RASTREADOR')">
                                <i class="bi bi-plus"></i> Nova
                            </button>
                        </div>
                        <div class="tasks-container"></div>
                    </div>

                    <div class="kanban-column" data-status="RASTREADOR_ACORDO_ASSINADO">
                        <div class="column-header">
                            <div class="column-title">
                                <h3>Acordo Assinado</h3>
                                <span class="column-count">0</span>
                            </div>
                            <button class="column-add-btn" type="button" onclick="window.processosBoard?.openCreateModal?.('RASTREADOR')">
                                <i class="bi bi-plus"></i> Nova
                            </button>
                        </div>
                        <div class="tasks-container"></div>
                    </div>

                    <div class="kanban-column" data-status="RASTREADOR_DEVOLVIDO">
                        <div class="column-header">
                            <div class="column-title">
                                <h3>Rastreador Devolvido</h3>
                                <span class="column-count">0</span>
                            </div>
                            <button class="column-add-btn" type="button" onclick="window.processosBoard?.openCreateModal?.('RASTREADOR')">
                                <i class="bi bi-plus"></i> Nova
                            </button>
                        </div>
                        <div class="tasks-container"></div>
                    </div>

                    <div class="kanban-column" data-status="RASTREADOR_REATIVACAO">
                        <div class="column-header">
                            <div class="column-title">
                                <h3>Reativação</h3>
                                <span class="column-count">0</span>
                            </div>
                            <button class="column-add-btn" type="button" onclick="window.processosBoard?.openCreateModal?.('RASTREADOR')">
                                <i class="bi bi-plus"></i> Nova
                            </button>
                        </div>
                        <div class="tasks-container"></div>
                    </div>
                </div>
            </div>

            <div class="kanban-section" data-group="FIDELIDADE">
                <div class="kanban-section-header">
                    <div class="kanban-section-info">
                        <h2 class="kanban-section-title">
                            <i class="bi bi-stars"></i>
                            Fidelidade
                        </h2>
                        <p class="kanban-section-subtitle">Status das ações de fidelização dos clientes.</p>
                    </div>
                    <span class="kanban-section-count" data-group-count="FIDELIDADE">0</span>
                </div>
                <div class="kanban-board" data-group="FIDELIDADE">
                    <div class="kanban-column" data-status="FIDELIDADE_EM_ABERTO">
                        <div class="column-header">
                            <div class="column-title">
                                <h3>Em Aberto</h3>
                                <span class="column-count">0</span>
                            </div>
                            <button class="column-add-btn" type="button" onclick="window.processosBoard?.openCreateModal?.('FIDELIDADE')">
                                <i class="bi bi-plus"></i> Nova
                            </button>
                        </div>
                        <div class="tasks-container"></div>
                    </div>

                    <div class="kanban-column" data-status="FIDELIDADE_EM_CONTATO">
                        <div class="column-header">
                            <div class="column-title">
                                <h3>Em Contato</h3>
                                <span class="column-count">0</span>
                            </div>
                            <button class="column-add-btn" type="button" onclick="window.processosBoard?.openCreateModal?.('FIDELIDADE')">
                                <i class="bi bi-plus"></i> Nova
                            </button>
                        </div>
                        <div class="tasks-container"></div>
                    </div>

                    <div class="kanban-column" data-status="FIDELIDADE_ACORDO_ASSINADO">
                        <div class="column-header">
                            <div class="column-title">
                                <h3>Acordo Assinado</h3>
                                <span class="column-count">0</span>
                            </div>
                            <button class="column-add-btn" type="button" onclick="window.processosBoard?.openCreateModal?.('FIDELIDADE')">
                                <i class="bi bi-plus"></i> Nova
                            </button>
                        </div>
                        <div class="tasks-container"></div>
                    </div>

                    <div class="kanban-column" data-status="FIDELIDADE_REATIVACAO">
                        <div class="column-header">
                            <div class="column-title">
                                <h3>Reativação</h3>
                                <span class="column-count">0</span>
                            </div>
                            <button class="column-add-btn" type="button" onclick="window.processosBoard?.openCreateModal?.('FIDELIDADE')">
                                <i class="bi bi-plus"></i> Nova
                            </button>
                        </div>
                        <div class="tasks-container"></div>
                    </div>
                </div>
            </div>

            <div class="kanban-section" data-group="TERCEIROS">
                <div class="kanban-section-header">
                    <div class="kanban-section-info">
                        <h2 class="kanban-section-title">
                            <i class="bi bi-people"></i>
                            Terceiros
                        </h2>
                        <p class="kanban-section-subtitle">Acompanhamento dos processos conduzidos por parceiros.</p>
                    </div>
                    <span class="kanban-section-count" data-group-count="TERCEIROS">0</span>
                </div>
                <div class="kanban-board" data-group="TERCEIROS">
                    <div class="kanban-column" data-status="EM_ABERTO_7_0">
                        <div class="column-header">
                            <div class="column-title">
                                <h3>Em Aberto</h3>
                                <span class="column-count">0</span>
                            </div>
                            <button class="column-add-btn" type="button" onclick="window.processosBoard?.openCreateModal?.('TERCEIROS')">
                                <i class="bi bi-plus"></i> Nova
                            </button>
                        </div>
                        <div class="tasks-container"></div>
                    </div>

                    <div class="kanban-column" data-status="EM_CONTATO_7_1">
                        <div class="column-header">
                            <div class="column-title">
                                <h3>Em Contato</h3>
                                <span class="column-count">0</span>
                            </div>
                            <button class="column-add-btn" type="button" onclick="window.processosBoard?.openCreateModal?.('TERCEIROS')">
                                <i class="bi bi-plus"></i> Nova
                            </button>
                        </div>
                        <div class="tasks-container"></div>
                    </div>

                    <div class="kanban-column" data-status="PROCESSO_JUDICIAL_7_2">
                        <div class="column-header">
                            <div class="column-title">
                                <h3>Processo Judicial</h3>
                                <span class="column-count">0</span>
                            </div>
                            <button class="column-add-btn" type="button" onclick="window.processosBoard?.openCreateModal?.('TERCEIROS')">
                                <i class="bi bi-plus"></i> Nova
                            </button>
                        </div>
                        <div class="tasks-container"></div>
                    </div>

                    <div class="kanban-column" data-status="ACORDO_ASSINADO_7_3">
                        <div class="column-header">
                            <div class="column-title">
                                <h3>Acordo Assinado</h3>
                                <span class="column-count">0</span>
                            </div>
                            <button class="column-add-btn" type="button" onclick="window.processosBoard?.openCreateModal?.('TERCEIROS')">
                                <i class="bi bi-plus"></i> Nova
                            </button>
                        </div>
                        <div class="tasks-container"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="kanban-modal" class="kanban-modal">
        <div class="kanban-modal-content">
            <div class="kanban-modal-header">
                <h2>Detalhes do processo</h2>
                <button class="kanban-modal-close" onclick="window.processosBoard?.closeModal?.()">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            <div class="kanban-modal-body"></div>
        </div>
    </div>

    <div id="create-processo-modal" class="kanban-modal">
        <div class="kanban-modal-content">
            <div class="kanban-modal-header">
                <h2><i class="bi bi-plus-circle"></i> Novo Processo</h2>
                <button class="kanban-modal-close" onclick="window.processosBoard?.closeCreateModal?.()">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            <div class="kanban-modal-body">
                <form id="create-processo-form" class="kanban-create-form">
                    <div id="create-processo-error" class="create-processo-error" role="alert" aria-live="assertive"></div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="create-process-type">Tipo de Cobrança *</label>
                            <select id="create-process-type" name="processType" required>
                                <option value="" selected disabled>Selecione um tipo</option>
                                <option value="RASTREADOR">Rastreador</option>
                                <option value="FIDELIDADE">Fidelidade</option>
                                <option value="TERCEIROS">Terceiros</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="create-autor">Autor *</label>
                            <input type="text" id="create-autor" name="autor" placeholder="Nome do autor" required>
                        </div>
                        <div class="form-group">
                            <label for="create-reu">Réu *</label>
                            <input type="text" id="create-reu" name="reu" placeholder="Nome do réu" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="create-materia">Matéria *</label>
                            <input type="text" id="create-materia" name="materia" placeholder="Matéria do processo" required>
                        </div>
                        <div class="form-group">
                            <label for="create-numero-processo">Nº Processo *</label>
                            <input type="text" id="create-numero-processo" name="numeroProcesso" placeholder="0000000-00.0000.0.00.0000" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="create-valor-causa">Valor da Causa (R$) *</label>
                            <input type="number" id="create-valor-causa" name="valorCausa" step="0.01" min="0" placeholder="0,00" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="create-pedidos">Pedidos *</label>
                        <textarea id="create-pedidos" name="pedidos" rows="4" placeholder="Descreva os pedidos principais" required></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="window.processosBoard?.closeCreateModal?.()">
                            <i class="bi bi-x-circle"></i>
                            Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-send-fill"></i> Registrar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const body = document.body;
            if (body) {
                body.classList.remove('no-dark-blur');
            }

            const main = document.querySelector('main.page');
            if (main) {
                main.classList.add('kanban-page');
            }

            const container = document.querySelector('main.page > .container');
            if (container) {
                container.classList.add('kanban-full-width');
            }

            const pageContent = document.querySelector('main.page > .container > .page-content');
            if (pageContent) {
                pageContent.classList.add('kanban-content-stretch');
            }
        });
    </script>
    <script th:src="@{/js/cobranca-kanban.js}"></script>
</section>
</body>
</html>
