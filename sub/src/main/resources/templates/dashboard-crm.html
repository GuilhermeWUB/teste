<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout-crm}">
<head>
    <title>SUB - CRM</title>
    <link rel="stylesheet" th:href="@{/css/crm-dashboard.css}">
</head>
<body>
<section layout:fragment="content" class="sales-page">
    <header class="crm-intro">
        <div>
            <p class="eyebrow text-uppercase mb-1">Módulo Comercial</p>
            <div class="d-flex flex-wrap align-items-center gap-2 mb-1">
                <h1 class="crm-intro__title mb-0" th:text="${crmHeroTitle}">CRM de Vendas</h1>
                <span class="pill pill--accent">Ambiente dedicado</span>
            </div>
            <p class="crm-intro__subtitle mb-0" th:text="${crmHeroSubtitle}">
                Centralize o funil, acompanhe follow-ups e enxergue a previsão de receita.
            </p>
        </div>
        <div class="crm-intro__actions">
            <a class="cta-button" th:href="@{/dashboard}">
                <i class="bi bi-arrow-left"></i>
                Voltar ao sistema
            </a>
            <button class="cta-button cta-button--ghost" type="button">
                <i class="bi bi-plus-circle"></i>
                Nova oportunidade
            </button>
        </div>
    </header>

    <div class="insight-grid">
        <article class="insight-card balance-card">
            <div class="insight-card__header">
                <div>
                    <p class="eyebrow text-uppercase mb-1">Saldo</p>
                    <h2 class="insight-card__title">Movimentação financeira</h2>
                    <p class="insight-card__subtitle">Controle o que já pode usar e o que entra em breve.</p>
                </div>
                <span class="pill pill--soft">Atualizado</span>
            </div>
            <div class="balance-summary">
                <div class="balance-line">
                    <div class="balance-label">Disponível</div>
                    <div class="balance-value" th:text="${crmBalanceAvailable} ?: 'R$ 0,00'">R$ 0,00</div>
                </div>
                <div class="balance-line">
                    <div class="balance-label">A receber</div>
                    <div class="balance-value" th:text="${crmBalanceToReceive} ?: 'R$ 0,00'">R$ 0,00</div>
                </div>
            </div>
            <div class="insight-card__actions">
                <a class="cta-button cta-button--light" th:href="@{/crm/financeiro}">
                    <i class="bi bi-wallet2"></i>
                    Ver extrato
                </a>
                <button class="cta-button cta-button--ghost" type="button">
                    <i class="bi bi-arrow-repeat"></i>
                    Gerar transferência
                </button>
            </div>
        </article>

        <article class="insight-card activities-card">
            <div class="insight-card__header">
                <div>
                    <p class="eyebrow text-uppercase mb-1">Atividades</p>
                    <h2 class="insight-card__title">Pendências do time</h2>
                    <p class="insight-card__subtitle">Priorize os follow-ups que mantêm o funil saudável.</p>
                </div>
                <span class="pill pill--soft">Agenda</span>
            </div>
            <div class="activity-badges">
                <div class="activity-count">
                    <span class="activity-label">Vencidas</span>
                    <strong class="activity-value" th:text="${crmActivitiesOverdue} ?: 0">0</strong>
                </div>
                <div class="activity-count">
                    <span class="activity-label">Para hoje</span>
                    <strong class="activity-value" th:text="${crmActivitiesToday} ?: 0">0</strong>
                </div>
            </div>
            <p class="insight-card__subtitle mb-3" th:text="${crmActivitiesHelper} ?: 'Tenha previsibilidade com as ações em dia.'">Tenha previsibilidade com as ações em dia.</p>
            <a class="cta-link" th:href="@{/crm/vendas}">
                <span>Acesse suas negociações</span>
                <i class="bi bi-arrow-right"></i>
            </a>
        </article>

        <article class="insight-card support-card">
            <div class="insight-card__header">
                <div>
                    <p class="eyebrow text-uppercase mb-1">Central de ajuda</p>
                    <h2 class="insight-card__title">Conte com o time</h2>
                    <p class="insight-card__subtitle">Encontre materiais ou fale com especialistas do CRM.</p>
                </div>
                <span class="pill pill--soft">Suporte</span>
            </div>
            <div class="support-links">
                <a class="support-link" th:href="${crmHelpCourseLink} ?: '#'" target="_blank" rel="noreferrer">
                    <i class="bi bi-play-circle"></i>
                    Curso rápido
                </a>
                <a class="support-link" th:href="${crmHelpCenterLink} ?: '#'" target="_blank" rel="noreferrer">
                    <i class="bi bi-life-preserver"></i>
                    Central de ajuda
                </a>
                <a class="support-link" th:href="${crmHelpTicketLink} ?: '#'" target="_blank" rel="noreferrer">
                    <i class="bi bi-send"></i>
                    Enviar solicitação
                </a>
            </div>
        </article>
    </div>

    <div class="row g-4">
        <div class="col-lg-8">
            <div class="sales-panel card border-0 shadow-sm h-100" id="pipeline">
                <div class="card-body">
                    <div class="section-head d-flex flex-wrap justify-content-between align-items-start gap-2 mb-3">
                        <div>
                            <p class="eyebrow text-uppercase mb-1">Funil de oportunidades</p>
                            <h5 class="mb-1">Visualização em colunas</h5>
                            <p class="text-muted mb-0">Acompanhe cada etapa e mantenha o time alinhado.</p>
                        </div>
                        <div class="d-flex flex-wrap align-items-center gap-2">
                            <span class="pill pill--success">Atualizado</span>
                            <button class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-funnel me-1"></i>
                                Filtros
                            </button>
                            <button class="btn btn-sm btn-primary">
                                <i class="bi bi-plus-circle me-1"></i>
                                Nova negociação
                            </button>
                        </div>
                    </div>

                    <div class="pipeline-board" role="list">
                        <article class="pipeline-column" role="listitem" th:each="column : ${crmPipelineColumns}">
                            <header class="pipeline-column__header">
                                <div>
                                    <p class="eyebrow text-uppercase mb-1">Etapa</p>
                                    <h6 class="mb-1" th:text="${column.name()}">Cotações recebidas</h6>
                                    <p class="text-muted small mb-0" th:text="${column.helper()}">Descrição</p>
                                </div>
                                <span class="pill pill--neutral" th:text="${column.badge()}"
                                      th:classappend="' ' + ${column.badgeClass()}">0</span>
                            </header>

                            <div class="pipeline-column__body">
                                <div class="deal-card" th:each="deal : ${column.deals()}">
                                    <div class="deal-card__title">
                                        <span class="status-dot" th:classappend="${deal.status()} == 'Urgente' ? ' status-dot--danger' :
                                                                     ${deal.status()} == 'Negociando' ? ' status-dot--warning' :
                                                                     ${deal.status()} == 'Vitória' ? ' status-dot--success' :
                                                                     ${deal.status()} == 'Concluído' ? ' status-dot--muted' :
                                                                     ' status-dot--info'"></span>
                                        <div class="fw-semibold" th:text="${deal.title()}">Oportunidade</div>
                                    </div>
                                    <p class="text-muted small mb-2" th:text="${deal.company()}">Empresa</p>
                                    <div class="deal-card__meta">
                                        <span class="badge bg-light text-dark" th:text="${deal.stage()}">Etapa</span>
                                        <span class="fw-semibold text-primary" th:text="${deal.amount()}">R$ 0,00</span>
                                    </div>
                                    <div class="deal-card__footer">
                                        <div class="deal-card__date">
                                            <i class="bi bi-calendar2-week"></i>
                                            <span th:text="${deal.dueDate()}">Hoje</span>
                                        </div>
                                        <div class="deal-card__actions">
                                            <button class="btn-icon" title="Comentários"><i class="bi bi-chat-dots"></i></button>
                                            <button class="btn-icon" title="Arquivos"><i class="bi bi-paperclip"></i></button>
                                            <button class="btn-icon" title="Mais opções"><i class="bi bi-three-dots"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </article>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="sales-panel card border-0 shadow-sm h-100" id="followups">
                <div class="card-body">
                    <div class="section-head d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <p class="eyebrow text-uppercase mb-1">Agenda</p>
                            <h5 class="mb-1">Próximos follow-ups</h5>
                            <p class="text-muted mb-0">Organize ligações, reuniões e envios de propostas.</p>
                        </div>
                        <span class="pill pill--success">Em dia</span>
                    </div>
                    <div class="activity-list" th:each="activity, iter : ${crmActivities}">
                        <div class="activity-item" th:classappend="${iter.last}? 'activity-item--last' : ''">
                            <div class="activity-icon" th:classappend="${activity.channel() == 'Ligação'} ? ' activity-icon--call' :
                                                            ${activity.channel() == 'E-mail'} ? ' activity-icon--mail' :
                                                            ${activity.channel() == 'Reunião'} ? ' activity-icon--meeting' :
                                                            ' activity-icon--chat'">
                                <i class="bi bi-telephone-outbound" th:if="${activity.channel() == 'Ligação'}"></i>
                                <i class="bi bi-envelope" th:if="${activity.channel() == 'E-mail'}"></i>
                                <i class="bi bi-people" th:if="${activity.channel() == 'Reunião'}"></i>
                                <i class="bi bi-chat-dots" th:if="${activity.channel() != 'Ligação' and activity.channel() != 'E-mail' and activity.channel() != 'Reunião'}"></i>
                            </div>
                            <div class="activity-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="mb-1" th:text="${activity.title()}">Tarefa</h6>
                                        <p class="text-muted small mb-1" th:text="${activity.owner()}">Responsável</p>
                                    </div>
                                    <span class="pill pill--neutral" th:text="${activity.channel()}">Canal</span>
                                </div>
                                <div class="d-flex align-items-center gap-2 text-muted small">
                                    <i class="bi bi-clock"></i>
                                    <span th:text="${activity.dueDate()}">Prazo</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="sales-panel card border-0 shadow-sm mt-4" id="leads">
        <div class="card-body">
            <div class="section-head d-flex justify-content-between align-items-center mb-3">
                <div>
                    <p class="eyebrow text-uppercase mb-1">Leads</p>
                    <h5 class="mb-1">Entradas recentes</h5>
                    <p class="text-muted mb-0">Novos contatos para prosseguir no funil.</p>
                </div>
                <a class="btn btn-outline-primary btn-sm" href="#">Ver todos</a>
            </div>
            <div class="row g-3">
                <div class="col-md-3" th:each="lead : ${crmLeads}">
                    <div class="lead-card card h-100 border-0 shadow-sm">
                        <div class="card-body">
                            <div class="d-flex align-items-center gap-2 mb-2">
                                <div class="avatar-circle">
                                    <i class="bi bi-person"></i>
                                </div>
                                <div>
                                    <h6 class="mb-0" th:text="${lead.name()}">Nome</h6>
                                    <p class="text-muted small mb-0" th:text="${lead.company()}">Empresa</p>
                                </div>
                            </div>
                            <p class="fw-semibold mb-1" th:text="${lead.interest()}">Interesse</p>
                            <span class="pill pill--neutral" th:text="${lead.source()}">Origem</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function () {
        const focusSection = /*[[${crmFocusSection}]]*/ null;
        if (focusSection) {
            const target = document.getElementById(focusSection);
            if (target) {
                target.scrollIntoView({behavior: 'smooth', block: 'start'});
            }
        }
    });
</script>
</body>
</html>
