<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" data-theme="light">
<script src="/js/layout.js"></script>
<head th:fragment="head">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="_csrf" th:content="${_csrf?.token}"/>
    <meta name="_csrf_header" th:content="${_csrf?.headerName}"/>
    <title th:text="${pageTitle} ?: 'SUB - Financeiro'">SUB - Financeiro</title>
    <link rel="icon" type="image/svg+xml" th:href="@{/images/favicon.svg}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/custom-dark-mode.css}">
</head>
<body>
<header th:fragment="header" class="topbar topbar-financeiro">
    <div class="brand">
        <a class="brand-link" th:href="@{/dashboard}" title="Voltar ao Dashboard">
            <img class="brand-logo" th:src="@{/images/ub_02_2.jpeg}" alt="SUB">
            <span class="brand-title">SUB</span>
        </a>
    </div>

    <input type="checkbox" id="navToggle" class="nav-toggle" aria-hidden="true">
    <label class="nav-toggle-label" for="navToggle" aria-label="Alternar navega√ß√£o">
        <span></span>
        <span></span>
        <span></span>
    </label>

    <nav class="topbar-nav" aria-label="Navega√ß√£o Financeiro">
        <ul class="nav-links">
            <!-- Navega√ß√£o espec√≠fica do m√≥dulo Financeiro -->
            <li class="nav-item-financeiro">
                <a th:href="@{/financeiro}" th:classappend="${currentPage == 'dashboard'} ? 'active' : ''">
                    <i class="bi bi-speedometer2 me-1"></i>
                    <span>Vis√£o Geral</span>
                </a>
            </li>
            <li class="nav-item-financeiro">
                <a th:href="@{/financeiro/receitas}" th:classappend="${currentPage == 'receitas'} ? 'active' : ''">
                    <i class="bi bi-graph-up-arrow me-1"></i>
                    <span>Receitas</span>
                </a>
            </li>
            <li class="nav-item-financeiro">
                <a th:href="@{/financeiro/despesas}" th:classappend="${currentPage == 'despesas'} ? 'active' : ''">
                    <i class="bi bi-graph-down-arrow me-1"></i>
                    <span>Despesas</span>
                </a>
            </li>
            <li class="nav-item-financeiro">
                <a th:href="@{/financeiro/fluxo-caixa}" th:classappend="${currentPage == 'fluxo-caixa'} ? 'active' : ''">
                    <i class="bi bi-cash-stack me-1"></i>
                    <span>Fluxo de Caixa</span>
                </a>
            </li>
            <li class="nav-item-financeiro">
                <a th:href="@{/financeiro/contas}" th:classappend="${currentPage == 'contas'} ? 'active' : ''">
                    <i class="bi bi-wallet2 me-1"></i>
                    <span>Contas</span>
                </a>
            </li>
            <li class="nav-item-financeiro">
                <a th:href="@{/financeiro/relatorios}" th:classappend="${currentPage == 'relatorios'} ? 'active' : ''">
                    <i class="bi bi-file-earmark-bar-graph me-1"></i>
                    <span>Relat√≥rios</span>
                </a>
            </li>

            <!-- A√ß√µes mobile -->
            <li class="nav-item-mobile-action">
                <a th:href="@{/dashboard}" class="btn btn-outline">
                    <i class="bi bi-arrow-left me-1"></i>
                    <span>Voltar ao Sistema</span>
                </a>
            </li>
            <li class="nav-item-theme nav-item-mobile-action">
                <button type="button" class="theme-toggle" data-theme-toggle>
                    <span class="theme-toggle__icon theme-toggle__icon--dark" aria-hidden="true">üåô</span>
                    <span class="theme-toggle__icon theme-toggle__icon--light" aria-hidden="true">
                        <i class="bi bi-sun-fill"></i></span>
                    <span class="theme-toggle__label"></span>
                </button>
            </li>
            <li class="nav-item-mobile-action" th:if="${isLoggedIn}">
                <a class="btn btn-outline" th:href="@{/logout}">
                    <i class="bi bi-box-arrow-right me-1"></i>
                    <span>Sair</span>
                </a>
            </li>
        </ul>
    </nav>

    <div class="topbar-actions">
        <!-- Bot√£o voltar ao sistema principal -->
        <a th:href="@{/dashboard}" class="btn-back-to-system" title="Voltar ao Dashboard">
            <i class="bi bi-arrow-left"></i>
            <span>Voltar</span>
        </a>

        <button type="button" class="theme-toggle" data-theme-toggle>
            <span class="theme-toggle__icon theme-toggle__icon--dark" aria-hidden="true"><i class="bi bi-moon-fill"></i></span>
            <span class="theme-toggle__icon theme-toggle__icon--light" aria-hidden="true"><i class="bi bi-sun-fill"></i></span>
            <span class="theme-toggle__label"></span>
        </button>
        <a class="btn btn-outline" th:if="${isLoggedIn}" th:href="@{/logout}">
            <i class="bi bi-box-arrow-right me-1"></i>
            <span>Sair</span>
        </a>
    </div>
</header>

<main class="page">
    <div class="container">
        <div class="page-content">
            <section layout:fragment="content"></section>
        </div>
    </div>
</main>

<footer class="site-footer">
    <div class="container">
        <p>&copy; <span th:text="${T(java.time.Year).now()}"></span> SUB - M√≥dulo Financeiro. Todos os direitos reservados.</p>
    </div>
</footer>

<button type="button" class="back-to-top" id="back-to-top" aria-hidden="true" tabindex="-1">
    <span class="back-to-top__icon" aria-hidden="true">‚¨Ü</span>
    <span class="back-to-top__text">Voltar ao topo</span>
</button>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    (function () {
        // Theme toggle
        const toggles = document.querySelectorAll('[data-theme-toggle]');
        const html = document.documentElement;

        function setTheme(theme) {
            html.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            toggles.forEach(toggle => {
                const label = toggle.querySelector('.theme-toggle__label');
                if (label) {
                    label.textContent = theme === 'dark' ? 'Modo claro' : 'Modo escuro';
                }
            });
        }

        const savedTheme = localStorage.getItem('theme') ||
            (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        setTheme(savedTheme);

        toggles.forEach(toggle => {
            toggle.addEventListener('click', () => {
                const current = html.getAttribute('data-theme');
                setTheme(current === 'dark' ? 'light' : 'dark');
            });
        });

        // Mobile nav toggle
        const navToggle = document.getElementById('navToggle');
        const topbar = document.querySelector('.topbar');

        if (navToggle && topbar) {
            navToggle.addEventListener('change', function() {
                if (this.checked) {
                    topbar.classList.add('nav-open');
                } else {
                    topbar.classList.remove('nav-open');
                }
            });
        }

        // Back to top
        const backToTop = document.getElementById('back-to-top');
        if (backToTop) {
            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) {
                    backToTop.classList.add('visible');
                } else {
                    backToTop.classList.remove('visible');
                }
            });

            backToTop.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }
    })();
</script>

<!-- Estilos espec√≠ficos do m√≥dulo Financeiro -->
<style>
    /* Bot√£o de voltar ao sistema */
    .btn-back-to-system {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: var(--bs-primary);
        color: white;
        border-radius: 9999px;
        font-size: 0.875rem;
        font-weight: 500;
        text-decoration: none;
        transition: all 0.2s ease;
    }

    .btn-back-to-system:hover {
        background: var(--bs-primary);
        filter: brightness(1.1);
        transform: translateY(-1px);
        color: white;
    }

    [data-theme="dark"] .btn-back-to-system {
        background: rgba(59, 130, 246, 0.8);
    }

    /* Links de navega√ß√£o do financeiro */
    .nav-item-financeiro a {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        padding: 0.5rem 0.75rem;
        border-radius: 0.5rem;
        transition: all 0.2s ease;
    }

    .nav-item-financeiro a:hover {
        background: rgba(59, 130, 246, 0.1);
    }

    .nav-item-financeiro a.active {
        background: rgba(59, 130, 246, 0.15);
        color: var(--bs-primary);
        font-weight: 600;
    }

    [data-theme="dark"] .nav-item-financeiro a:hover {
        background: rgba(59, 130, 246, 0.2);
    }

    [data-theme="dark"] .nav-item-financeiro a.active {
        background: rgba(59, 130, 246, 0.25);
    }

    /* Badge do m√≥dulo na brand */
    .topbar-financeiro .brand-link::after {
        content: 'Financeiro';
        display: inline-flex;
        align-items: center;
        margin-left: 0.75rem;
        padding: 0.25rem 0.625rem;
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        border-radius: 9999px;
        font-size: 0.6875rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    @media (max-width: 768px) {
        .btn-back-to-system span {
            display: none;
        }

        .topbar-financeiro .brand-link::after {
            display: none;
        }
    }
</style>
</body>
</html>
